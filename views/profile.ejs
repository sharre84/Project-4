<div class="container">

  <div class="profile center-align">
    <p class="profile-info">
      <h5>Name: <%= user.local.name %></h5>
      <h5>Email: <%= user.local.email %></h5>
      <h5>Vehicle: <%= user.car %></h5>
    </p>
    <a href="/user/<%= user._id %>" class="btn waves-effect waves-light">Edit Account</a>
    <a href="/user/<%= user._id %>/delete" id="delete-account" class="btn waves-effect waves-light">Delete Your Account</a>
  </div>


  <h4 class="center-align">Choose your vehicle:</h4>

  <div class="row center-align">
    <form class="col s12" id="new-search" action="/" method="post">
      <div class="row">
        <div class="input-field col s6 offset-s3">

          <input type="text" id="make" name="content" placeholder="Make" required>
          <input type="text" id="model" name="content" placeholder="Model" required>
          <input type="number" id="year" name="content" placeholder="Year" required>
          <button class='btn waves-effect waves-light' type="submit" id="add-service">Find<i class="material-icons right">send</i></button>
        </div>
      </div>
    </form>
    </div>
    <div class="table-results">
      <ul id="results" style="list-style: none"></ul>
    </div>
  </div>




  <script type="text/javascript">

  var resultsList = $('#results')

  $('#add-service').on('click', function(evt){
    evt.preventDefault();
  })

  $('#delete-account').on('click', function(e){

    if (! confirm("Are you sure you want to permanently delete your account?!")) {
      e.preventDefault()
    }
  })


  $('#add-service').on('click', function(){
    var model = $('#model').val()
    var make = $('#make').val()
    var year = $('#year').val()
    var carSearch = {}
    carSearch.model = model;
    carSearch.make = make;
    carSearch.year = Number(year);

    console.log(carSearch);
    $.ajax({
      // url: '/user/<%= user._id %>/testcar',
      url: '/findcar',
      method: 'POST',
      // contentType: 'application/json',
      json: true,
      data: carSearch
    }).done(function(data){
      resultsList.empty()
      var carObject = JSON.parse(data)
      var stylesArr = carObject.styles
      for (var i = 0; i < stylesArr.length; i ++) {
        console.log(stylesArr[i]);
        resultsList.append('<li><a class="car-result">' + stylesArr[i].name + '</a></li>')

      }
      $('li').on('click', function(){
        console.log($(this).text());
        console.log('/user/<%= user._id %>/testcar')
        var fullCar = make + ' ' + model + ' ' + $(this).text()
        setCar(fullCar)
      });
    })
  })

  function setCar(car) {
    $.ajax({
      method: 'PATCH',
      url: '/user/<%= user._id %>/setcar?car=' + car
    }).done(function(data) {
      console.log(data)
      $('#usercar').text(data.user.car)
      console.log(data.user);
    })
  }

  </script>
